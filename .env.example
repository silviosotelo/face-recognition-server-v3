# ============================================================
# FACE RECOGNITION SERVER v4.1 — CONFIGURACIÓN
# ============================================================
# cp .env.example .env   y ajusta los valores

# ============================================================
# SERVIDOR
# ============================================================
PORT=4350
NODE_ENV=production

# ============================================================
# BASE DE DATOS — PostgreSQL
# ============================================================

# ── Opción A (recomendada): URL completa ──────────────────────
# Útil en Docker / servicios cloud (Supabase, Railway, Render, etc.)
DATABASE_URL=postgresql://postgres:password@localhost:5432/face_recognition

# ── Opción B: variables individuales ─────────────────────────
# Ignoradas si DATABASE_URL está definida
PGHOST=localhost
PGPORT=5432
PGDATABASE=face_recognition
PGUSER=postgres
PGPASSWORD=password
PGSSL=false

# Pool de conexiones (clave para PM2 cluster)
# Cada worker PM2 abre su propio pool → pool_max × workers = conexiones totales
# Asegúrate de que PostgreSQL tenga suficientes (max_connections ≥ DB_POOL_MAX × PM2_INSTANCES)
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_TIMEOUT=5000

# ============================================================
# ARCHIVOS Y UPLOADS
# ============================================================
MAX_FILE_SIZE=50mb
UPLOAD_PATH=./public/uploads
MODELS_PATH=./public/models

# ============================================================
# CORS Y SEGURIDAD
# ============================================================
ALLOWED_ORIGINS=*

# ============================================================
# CACHE (Redis + fallback memoria)
# ============================================================
CACHE_ENABLED=true
CACHE_TTL=3600
CACHE_MAX_SIZE=1000

REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=

# ============================================================
# LOGGING
# ============================================================
LOG_LEVEL=info
LOG_FILE=./logs/app.log

# ============================================================
# GPU / TENSORFLOW
# ============================================================
TF_FORCE_GPU_ALLOW_GROWTH=true
GPU_WARMUP=true

# ============================================================
# RECONOCIMIENTO FACIAL
# ============================================================
FACE_CONFIDENCE_THRESHOLD=0.42
FACE_DETECTION_CONFIDENCE=0.65
FACE_LANDMARK_CONFIDENCE=0.7

FACE_MIN_SIZE=60
FACE_MAX_SIZE=800

FACE_INPUT_SIZE_TINY=416
FACE_INPUT_SIZE_SSD=512
FACE_INPUT_SIZE_SSD_GPU=608
FACE_MAX_RESULTS=1

REGISTER_CONFIDENCE=0.75
REGISTER_DETECTION_CONFIDENCE=0.8

RECOGNIZE_CONFIDENCE=0.42
RECOGNIZE_DETECTION_CONFIDENCE=0.65

PRECISE_CONFIDENCE=0.35
PRECISE_DETECTION_CONFIDENCE=0.7

FACE_DETECTION_TIMEOUT=10000
FACE_MODEL_LOAD_TIMEOUT=60000

IMAGE_MIN_WIDTH=200
IMAGE_MIN_HEIGHT=200
IMAGE_MAX_WIDTH=2048
IMAGE_MAX_HEIGHT=2048
IMAGE_QUALITY=0.9

REQUIRE_LANDMARKS=true
REQUIRE_EXPRESSIONS=false
VALIDATE_FACE_AREA=true
VALIDATE_FACE_CLARITY=true

# ============================================================
# ÍNDICE HNSW
# ============================================================
HNSW_INDEX_PATH=./data/hnsw.index
HNSW_META_PATH=./data/hnsw.meta.json

# ============================================================
# BATCH PROCESSING
# ============================================================
BATCH_MAX_SIZE=50
BATCH_CONCURRENCY=4
BATCH_JOB_TTL_MS=3600000

# ============================================================
# CACHE ESPECÍFICO RECONOCIMIENTO
# ============================================================
FACE_CACHE_ENABLED=true
FACE_CACHE_TTL=1800
FACE_CACHE_MAX_USERS=500
